webpackJsonp([2],{"/KId":function(e,t){},"4NlO":function(e,t){},Cdx3:function(e,t,o){var n=o("sB3e"),l=o("lktj");o("uqUo")("keys",function(){return function(e){return l(n(e))}})},"H/fx":function(e,t){},LGDg:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("//Fk"),l=o.n(n),r=o("Gu7T"),a=o.n(r),s=o("Dd8w"),i=o.n(s),c=o("STSY"),u=o("vZEL"),d=o("sB8F"),m={name:"role-edit",data:function(){var e=this;return{treeData:[],users:[],tableColumns:[{type:"selection",width:80,align:"center"},{title:"模块名称",key:"moduleName",align:"center"},{title:"备注",key:"remark"}],currentCanUseOps:[],currentSelectModule:null,tableData:[],showOrg:!1,moduleShow:!1,roleInfo:{roleName:"",roleType:"",remark:"",modules:[],orgId:void 0,loginPlatforms:[],loginPlatform:Number},num:1,opModuleMap:{},roleInfoRules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],orgId:[{required:!0,trigger:"change",validator:function(t,o,n){var l=document.getElementsByClassName("vue-treeselect__control")[0],r=document.getElementsByClassName("vue-treeselect__control-arrow")[0];o?(l.style.border="1px solid #dcdee2",r.style.color="#dcdee2",n()):(r.style.color="#ed4014",l.style.border="1px solid #ed4014",e.showOrg=!0,n())}}],loginPlatforms:[{required:!0,type:"array",min:1,message:"请选择登录权限",trigger:"change"},{type:"array",max:2,message:this.$t_p("login_permission_tip"),trigger:"change"}],roleType:[{required:!0,message:"请选择角色类型",trigger:"change"}]},isBtnLoading:!1}},methods:{roleChange:function(e){},orgChange:function(e){if(""!=e||null!=e){this.showOrg=!1;var t=document.getElementsByClassName("vue-treeselect__control")[0],o=document.getElementsByClassName("vue-treeselect__control-arrow")[0];t.style.border="1px solid #dcdee2",o.style.color="#616161"}},isMatchRoleType:function(e){return(e.manager||"").split(",").includes(this.roleInfo.roleType+"")},parseTreeData:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],l={title:e.moduleName,moduleId:e.moduleId,moduleCode:e.moduleCode,moduleName:e.moduleName,name:e.moduleName,operations:[],expand:o<2,children:[],render:function(e,o){o.root,o.node;var n=o.data;return e("span",{style:{cursor:"pointer",lineHeight:"1.4em"},on:{click:function(){t.onTreeSelectChange([n])}}},[e("Icon",{style:{color:"#2e8cf0",verticalAlign:"middle",fontSize:"1.1",marginRight:"3px"}}),e("span",{style:{color:"#fff",verticalAlign:"middle"}},n.title)])}};return e.children&&e.children.length&&(l.children=e.children.map(function(e){return t.parseTreeData(e,o+1,n)})),e.operations&&e.operations.forEach(function(e){l.operations.push(e),n.includes(e.moduleId)&&(l.checked=!0),t.opModuleMap[e.moduleId]=e,t.currentCanUseOps.push(e.moduleId)}),l},loadTreeData:function(){var e=this;Object(c.d)({}).then(function(t){e.treeRawData=t.data||[],e.refreshTree(!0)})},refreshTree:function(e){var t=this;this.currentCanUseOps=[],this.treeData=this.treeRawData.map(function(e){return t.parseTreeData(e,0,t.roleInfo.modules)})},onTreeCheckChange:function(e){var t=this;e.length>0&&(this.moduleShow=!1);var o=[];e.forEach(function(e){var n=!0,l=[];e.operations&&e.operations.forEach(function(e){null!=e.moduleId&&o.push(e.moduleId),t.roleInfo.modules.includes(e.moduleId)&&(n=!1),l.push(e.moduleId)}),n&&(t.roleInfo.modules=t.roleInfo.modules.concat(l))});for(var n=[].concat(this.roleInfo.modules),l=n.length-1;l>=0;l--)o.includes(n[l])||n.splice(l,1);this.roleInfo.modules=n,console.log("----------------",this.currentSelectModule),this.currentSelectModule&&(this.tableData=(this.currentSelectModule.operations||[]).map(function(e){return i()({},e,{_checked:t.isOpSelected(e)})}))},onTreeSelectChange:function(e){var t=this;console.log("=================",e),e.length>0?(this.currentSelectModule=i()({},e[0]),this.tableData=(this.currentSelectModule.operations||[]).map(function(e){return i()({},e,{_checked:t.isOpSelected(e)})})):(this.currentSelectModule=null,this.tableData=[])},loadRoleInfo:function(){var e=this;null!=this.roleId&&Object(c.f)({roleId:this.roleId}).then(function(t){var o=t.data||{},n=[];3==o.loginPlatform?n=["1","2"]:1==o.loginPlatform?n=["1"]:2==o.loginPlatform&&(n=["2"]),e.roleInfo=i()({},o,{orgId:null==o.orgId?"":o.orgId+"",roleType:null==o.roleType?"":o.roleType+"",loginPlatforms:n}),e.treeData.length&&e.refreshTree()})},getUsers:function(){var e=this;this.roleId&&Object(c.h)({roleId:this.roleId}).then(function(t){e.users=t.data||[]})},isOpSelected:function(e){return(this.roleInfo.modules||[]).includes(e.moduleId)},saveCurrentModuleLocal:function(e){this.roleInfo.modules||(this.roleInfo.modules=[]);var t=[].concat(a()(this.roleInfo.modules));this.currentSelectModule.operations.forEach(function(e){t.includes(e.moduleId)&&t.splice(t.indexOf(e.moduleId),1)}),e.forEach(function(e){t.includes(e.moduleId)||t.push(e.moduleId)}),this.roleInfo.modules=t,this.refreshTree()},checkRoleFrom:function(){var e=this;return new l.a(function(t,o){e.$refs.roleForm.validate(function(e,n){e?t():o(e,n)})})},saveRole:function(){var e=this;0==this.roleInfo.modules.length?this.moduleShow=!0:this.moduleShow=!1,this.checkRoleFrom().then(function(){e.isBtnLoading=!0;var t=[];if((e.roleInfo.modules||[]).forEach(function(o){e.currentCanUseOps.includes(o)&&t.push(o)}),e.roleId){var o=0;e.roleInfo.loginPlatforms.map(function(e){return o=Number(e)+o}),e.roleInfo.loginPlatform=o,Object(c.c)(i()({},e.roleInfo,{roleId:e.roleId,modules:t})).then(function(){e.$Message.success(e.$t("common.message.save_success")),e.$router.replace({name:"role-list"}),e.loadRoleInfo()},function(t){e.$Message.warning(t.serverMessage||e.$t("common.message.save_fail"))}).finally(function(){e.isBtnLoading=!1})}else{var n=0;e.roleInfo.loginPlatforms.map(function(e){return n=Number(e)+n}),e.roleInfo.loginPlatform=n,Object(c.a)(i()({},e.roleInfo,{modules:t})).then(function(){e.$Message.success(e.$t("common.message.add_success")),e.$router.replace({name:"role-list"})},function(t){e.$Message.warning(t.serverMessage||e.$t("common.message.save_fail"))}).finally(function(){e.isBtnLoading=!1})}})}},watch:{roleId:function(e){null!=e&&this.loadRoleInfo()}},computed:{roleId:function(){return this.$route.params.roleId}},mounted:function(){this.loadTreeData(),this.loadRoleInfo()},components:{RoleTypeSelect:u.a,OrgSelect:d.a}},f={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"role-edit"},[o("div",{staticClass:"content"},[o("div",{staticClass:"header-sub"},[o("div",{staticClass:"title"},[o("div",{staticClass:"btn-back",on:{click:function(t){e.$router.push({name:"role-list",query:{pageIndex:e.pageIndex,pageSize:e.pageSize,currentIndex:e.currentIndex}})}}},[o("Icon",{attrs:{type:"ios-arrow-back"}})],1),e._v(" "),o("div",{staticClass:"breadcrumb-item",on:{click:function(t){e.$router.push({name:"role-list",query:{pageIndex:e.pageIndex,pageSize:e.pageSize,currentIndex:e.currentIndex}})}}},[e._v("\n          角色列表\n        ")]),e._v(" "),o("div",{staticClass:"breadcrumb-item-line"},[e._v("/")]),e._v(" "),e.roleId?o("div",{staticClass:"breadcrumb-item-link"},[e._v("编辑角色")]):o("div",{staticClass:"breadcrumb-item-link"},[e._v("新增角色")]),e._v(" "),o("span",{staticClass:"empty"})])]),e._v(" "),o("div",{staticClass:"head-top"},[o("Form",{ref:"roleForm",staticClass:"role-form form",attrs:{model:e.roleInfo,rules:e.roleInfoRules,"label-width":e.$flexible(110)}},[o("div",{staticClass:"title"},[e._v("基本信息")]),e._v(" "),o("FormItem",{staticClass:"form-item",attrs:{prop:"roleName",label:"角色名称"}},[o("Input",{staticClass:"form-input",attrs:{maxlength:50},model:{value:e.roleInfo.roleName,callback:function(t){e.$set(e.roleInfo,"roleName",t)},expression:"roleInfo.roleName"}})],1),e._v(" "),o("FormItem",{staticClass:"form-item",attrs:{prop:"roleType",label:"角色类型"}},[o("RoleTypeSelect",{staticClass:"form-input",on:{"on-selection-change":e.roleChange},model:{value:e.roleInfo.roleType,callback:function(t){e.$set(e.roleInfo,"roleType",t)},expression:"roleInfo.roleType"}})],1),e._v(" "),o("FormItem",{staticClass:"form-item form-org",attrs:{prop:"orgId",label:"所属区域",id:"org"}},[o("OrgSelect",{staticClass:"form-input",on:{"on-selection-change":e.orgChange},model:{value:e.roleInfo.orgId,callback:function(t){e.$set(e.roleInfo,"orgId",t)},expression:"roleInfo.orgId"}}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.showOrg,expression:"showOrg"}],staticClass:"red"},[e._v("请选择区域")])],1),e._v(" "),o("FormItem",{staticClass:"form-item",attrs:{prop:"remark",label:"角色描述"}},[o("Input",{staticClass:"form-input",attrs:{maxlength:50},model:{value:e.roleInfo.remark,callback:function(t){e.$set(e.roleInfo,"remark",t)},expression:"roleInfo.remark"}})],1),e._v(" "),o("FormItem",{staticClass:"form-item",attrs:{prop:"loginPlatforms",label:"登陆权限"}},[o("checkbox-group",{staticClass:"form-input",model:{value:e.roleInfo.loginPlatforms,callback:function(t){e.$set(e.roleInfo,"loginPlatforms",t)},expression:"roleInfo.loginPlatforms"}},[o("Checkbox",{attrs:{label:"1"}},[e._v("WEB")]),e._v(" "),o("Checkbox",{attrs:{label:"2"}},[e._v("微信")])],1)],1)],1)],1),e._v(" "),o("div",{staticClass:"wrapper"},[o("div",{staticClass:"left"},[o("div",{staticClass:"title"},[e._v("\n          菜单权限\n          "),o("span",{directives:[{name:"show",rawName:"v-show",value:e.moduleShow,expression:"moduleShow"}],staticClass:"red"},[e._v("请输入搜索内容")])]),e._v(" "),o("div",{staticClass:"block"},[o("div",{staticClass:"area-tree"},[o("Tree",{ref:"area_tree",attrs:{"show-checkbox":"",data:e.treeData},on:{"on-select-change":e.onTreeSelectChange,"on-check-change":e.onTreeCheckChange}})],1)])]),e._v(" "),o("div",{staticClass:"right"},[o("div",{staticClass:"title"},[e._v("\n          功能权限\n          "),o("span",{staticClass:"sm"},[e._v(" "+e._s(e.currentSelectModule&&e.currentSelectModule.name))])]),e._v(" "),o("div",{staticClass:"block"},[o("div",{staticClass:"user-table no-scroll"},[o("Table",{staticClass:"m-table",staticStyle:{"overflow-x":"hidden"},attrs:{stripe:"",border:!0,columns:e.tableColumns,data:e.tableData,"no-data-text":"空"},on:{"on-selection-change":e.saveCurrentModuleLocal}})],1)])])]),e._v(" "),o("div",{staticClass:"role-ops"},[o("Button",{staticClass:"btn",attrs:{size:"large",type:"primary"},on:{click:function(t){e.$router.push({name:"role-list"})}}},[e._v(e._s(e.$t("common.message.cancel"))+"\n      ")]),e._v(" "),o("Button",{staticClass:"btn",staticStyle:{"margin-left":"40px"},attrs:{size:"large",loading:e.isBtnLoading,type:"default"},on:{click:e.saveRole}},[e._v(e._s(e.$t("common.message.save"))+"\n      ")])],1)])])},staticRenderFns:[]};var h=o("VU/8")(m,f,!1,function(e){o("a0vb")},"data-v-5813648f",null).exports;t.default=h},a0vb:function(e,t){},fZjL:function(e,t,o){e.exports={default:o("jFbC"),__esModule:!0}},jFbC:function(e,t,o){o("Cdx3"),e.exports=o("FeBl").Object.keys},sB8F:function(e,t,o){"use strict";var n=o("8urd"),l=o("GXH0"),r=o.n(l),a=(o("DmJO"),o("/KId"),{name:"org-select",i18n_prefix:"component.org-select",data:function(){return{treeData:[]}},props:{value:[String,Array],multiple:Boolean,label:[String,Array],includeSelf:Boolean},model:{prop:"value",event:"selection"},methods:{loadTreeData:function(){var e=this;(this.includeSelf?n.d:n.g)({level:99}).then(function(t){var o=t.data;e.treeData=function e(t){return t.map(function(t){var o=t.id,n=t.children,l={id:o+"",label:t.orgName};return n&&n.length&&(l.children=e(n)),l})}(o)})},onSelectionChange:function(e){this.$emit("selection",e),this.$emit("on-selection-change",e)}},mounted:function(){this.loadTreeData()},destroyed:function(){},components:{TreeSelect:r.a}}),s={render:function(){var e=this.$createElement;return(this._self._c||e)("TreeSelect",{staticClass:"org-select",attrs:{value:this.value,label:this.label,placeholder:this.$t_p("placeholder"),noResultsText:this.$t_p("noResultsText"),multiple:this.multiple,options:this.treeData},on:{input:this.onSelectionChange}})},staticRenderFns:[]};var i=o("VU/8")(a,s,!1,function(e){o("H/fx"),o("x8/l")},"data-v-1a1e6a87",null).exports;t.a=i},vZEL:function(e,t,o){"use strict";var n=o("fZjL"),l=o.n(n),r=o("BTaQ"),a=o("ErfN"),s={name:"role-type-select",data:function(){return{options:[]}},props:{value:String,placeholder:String,show:Boolean},model:{prop:"value",event:"selection"},methods:{loadTreeData:function(){this.options=l()(a.b).map(function(e){return{value:e,label:a.b[e]}})},onSelectionChange:function(e){this.$emit("selection",e),this.$emit("on-selection-change",e)}},mounted:function(){this.loadTreeData()},components:{Select:r.Select}},i={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("Select",{staticClass:"role-select",attrs:{value:e.value,placeholder:e.placeholder},on:{input:e.onSelectionChange}},[o("Option",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],key:"-1",attrs:{value:""}},[e._v(e._s(e.$t("common.text.all")))]),e._v(" "),e._l(e.options,function(t){return o("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})],2)},staticRenderFns:[]};var c=o("VU/8")(s,i,!1,function(e){o("4NlO")},"data-v-b8322b40",null).exports;t.a=c},"x8/l":function(e,t){}});
//# sourceMappingURL=2.e81827558730e91b5d8e.js.map