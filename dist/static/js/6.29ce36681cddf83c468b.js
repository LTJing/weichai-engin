webpackJsonp([6],{"/KId":function(e,t){},"H/fx":function(e,t){},W4Yq:function(e,t){},ifuq:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Dd8w"),s=a.n(n),o=a("//Fk"),l=a.n(o),r=a("vMJZ"),i=a("sB8F"),c=a("BTaQ"),u=a("STSY"),d={name:"role-select",data:function(){return{options:[],optionMap:{}}},props:{value:String,placeholder:String,type:String},model:{prop:"value",event:"selection"},watch:{type:function(){this.loadTreeData()}},methods:{loadTreeData:function(){var e=this;Object(u.e)({orgId:0}).then(function(t){var a={};e.options=(t.data||[]).map(function(e){return a[e.roleId]=e,{value:e.roleId+"",label:""+e.roleName}}),e.optionMap=a})},onSelectionChange:function(e){this.$emit("selection",e),this.$emit("on-selection-change",this.optionMap[e])}},mounted:function(){this.loadTreeData()},components:{Select:c.Select}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Select",{staticClass:"role-select",attrs:{value:e.value,placeholder:e.placeholder},on:{input:e.onSelectionChange}},e._l(e.options,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)},staticRenderFns:[]};var f=a("VU/8")(d,m,!1,function(e){a("iiIu")},"data-v-4879310a",null).exports,p={name:"user-manage",components:{OrgSelect:i.a,RoleSelect:f},data:function(){var e=this;return{showDrawer:!1,saveLoading:!1,title:"新增用户",search:{},pageInfo:{pageIndex:1,pageSize:10,totalElements:0,loading:!1},tableData:[],formRule:{roleId:[{required:!0,validator:function(t,a,n){e.formData.orgId?n():n("角色不能为空")},trigger:"blur"}],orgId:[{required:!0,validator:function(e,t,a){null==t||""==t?a("所属区域不能为空"):a()},trigger:"submit"}],userName:[{required:!0,message:"用户名不能为空",trigger:"submit"}],fullName:[{required:!0,message:"姓名不能为空",trigger:"submit"}],passwd:[{required:!0,validator:function(t,a,n){if(e.formData.userId)n();else{/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/.test(a)?n():n("请填写正确的密码格式（至少6位数字与字母的结合）")}},trigger:"submit"}],phoneNumber:[{validator:function(e,t,a){if(t){/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$|400[0-9]{7}|^800[0-9]{7}/.test(t)?a():a("请填写正确的手机号码")}else a()},trigger:"blur"}]},formData:{},currentIndex:0,tableColumns:[{title:"用户名",key:"userName",align:"left"},{title:"姓名",key:"fullName",align:"left"},{title:"角色",key:"roleName",align:"left"},{title:"所属区域",key:"orgName",align:"left"},{title:"手机号",key:"phoneNumber",align:"left"},{title:"登录权限",key:"state",align:"left",render:function(t,a){return t("div",[t("i-switch",{props:{size:"small",value:!0===a.row.state,disable:!0},on:{"on-change":function(){e.togglePlanStatus(a.row)}}},[t("span",{props:{slot:"open"}},"开"),t("span",{props:{slot:"close"}},"关")])])}},{title:"操作",key:"action",align:"left",width:200,render:function(t,a){return t("div",[e.$hasAccess("user.edit")&&t("span",{props:{type:"text",size:"small"},class:"primary",style:{color:"#0084FF"},on:{click:function(){e.editUser(a)}}},"编辑"),e.$hasAccess("user.del")&&t("span",{props:{type:"text",size:"small"},style:{color:"rgba(241, 33, 33, 1)"},class:"secondary",on:{click:function(){e.deleteUser(a)}}},"删除")])}}]}},methods:{addUser:function(){this.title="新增用户",this.formData={state:!0},this.showDrawer=!0},checkRoleFrom:function(){var e=this;return new l.a(function(t,a){e.$refs.fromBase.validate(function(e,n){e?t():a(e,n)})})},editUser:function(e){var t=s()({},e.row),a=0!=t.allData,n=0!=t.state;this.formData=s()({},t,{allData:a,state:n,orgId:e.row.orgId+"",roleId:e.row.roleId}),this.title="编辑用户",this.showDrawer=!0},onSave:function(){var e=this;this.checkRoleFrom().then(function(){if(e.formData.userId){var t=s()({},e.formData,{state:!0===e.formData.state?1:2,allData:!0===e.formData.allData?1:0});e.saveLoading=!0,Object(r.c)(t).then(function(t){e.saveLoading=!1,e.$Message.success("编辑成功"),e.showDrawer=!1,e.loadTableData()},function(t){e.saveLoading=!1,1e3===t.code?e.$Message.warning(t.msg):e.$Message.warning("编辑失败")}).finally(function(){e.isUserBtnLoading=!1})}else{var a=s()({},e.formData,{state:!0===e.formData.state?1:2,allData:!0===e.formData.allData?1:0});Object(r.a)(a).then(function(t){e.saveLoading=!1,e.showDrawer=!1,e.$Message.success("新增成功"),e.loadTableData()},function(t){e.saveLoading=!1,1e3===t.code?e.$Message.warning(t.msg):e.$Message.warning("新增失败")}).finally(function(){e.saveLoading=!1})}})},rowClassName:function(e,t){if(e.id==this.currentIndex)return"demo-table-info-row"},deleteUser:function(e){var t=this,a=this.tableData[e.index];this.$Modal.confirm({title:"提示",width:this.$flexible(450),content:"确认删除用户名为["+a.userName+"]的用户吗?",onOk:function(){Object(r.b)({userId:a.userId}).then(function(){t.$Message.success("删除成功"),t.loadTableData()},function(e){1e3===e.code?t.$Message.warning(e.msg):t.$Message.warning("删除失败")})}})},togglePlanStatus:function(e){var t=this;e.state=!e.state;var a={userId:e.userId,state:!0===e.state?1:2},n=e.state;Object(r.c)(a).then(function(){t.$Message.success("操作成功")}).catch(function(){t.$Message.error("操作失败"),e.state=n?0:1}).finally(function(){})},onDeviceModelChange:function(e){this.checkRoleFrom.roleId=e.roleId},loadTableData:function(e){var t=this;this.loading=!0,e&&(this.pageInfo.pageIndex=1),Object(r.e)({pageNumber:this.pageInfo.pageIndex,pageSize:this.pageInfo.pageSize,name:this.search.name}).then(function(e){t.loading=!1,t.serLoading=!1;var a=[];a=e.data.result||[],t.tableData=a.map(function(e){return s()({},e,{roleId:e.roleId+"",state:1===e.state,allData:1===e.allData})}),t.pageInfo.totalElements=e.data.totalElements||0})},onPaginationChange:function(e){this.pageInfo.pageIndex=e,this.loadTableData(this.currentOrgId,!1)},onPaginationSizeChange:function(e){this.pageInfo.pageSize=e,this.loadTableData(this.currentOrgId,!0)}},watch:{},mounted:function(){this.loadTableData(!0)}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user-manage"},[a("div",{staticClass:"content"},[e._m(0),e._v(" "),a("div",{staticClass:"filter-search"},[a("div",{staticClass:"filter-search-left"},[a("div",{staticClass:"filter-input mr-12"},[a("Input",{attrs:{placeholder:"请输入用户名/姓名",clearable:"",maxlength:"20"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.loadTableData(t):null}},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}})],1),e._v(" "),a("div",{staticClass:"filter-btn"},[a("Button",{attrs:{type:"default",loading:e.pageInfo.loading},on:{click:e.loadTableData}},[a("span",{staticClass:"iconfont icon-chazhao"})])],1)]),e._v(" "),a("div",{staticClass:"filter-search-right"},[a("span",{staticClass:"t-btn"},[a("Button",{on:{click:e.addUser}},[a("span",{staticClass:"iconfont icon-a-lianhe68"}),e._v("\n            新增\n          ")])],1)])]),e._v(" "),a("div",{staticClass:"user-table"},[a("Table",{staticClass:"m-table no-scroll no-border",attrs:{stripe:"","max-height":600,"row-class-name":e.rowClassName,loading:e.pageInfo.loading,columns:e.tableColumns,data:e.tableData}})],1),e._v(" "),a("div",{staticClass:"pagination"},[a("Page",{attrs:{current:e.pageInfo.pageIndex,"page-size":e.pageInfo.pageSize,total:e.pageInfo.totalElements,"show-sizer":""},on:{"on-change":e.onPaginationChange,"on-page-size-change":e.onPaginationSizeChange}})],1)]),e._v(" "),a("Drawer",{attrs:{width:"720",closable:!1,"mask-closable":!0},model:{value:e.showDrawer,callback:function(t){e.showDrawer=t},expression:"showDrawer"}},[a("div",{staticClass:"now-form-title",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(e.title))])]),e._v(" "),e.showDrawer?a("Form",{ref:"fromBase",staticClass:"form",attrs:{rules:e.formRule,model:e.formData,"label-width":e.$flexible(100)}},[a("FormItem",{staticClass:"form-item",staticStyle:{"margin-bottom":"20px"},attrs:{label:"所属区域：",prop:"orgId"}},[a("OrgSelect",{staticClass:"form-input",attrs:{placeholder:"请选择所属区域"},model:{value:e.formData.orgId,callback:function(t){e.$set(e.formData,"orgId",t)},expression:"formData.orgId"}})],1),e._v(" "),a("FormItem",{staticClass:"form-item",staticStyle:{"margin-bottom":"20px"},attrs:{label:"用户角色：",prop:"roleId"}},[a("RoleSelect",{attrs:{type:e.formData.orgId,placeholder:"请选择用户角色"},model:{value:e.formData.roleId,callback:function(t){e.$set(e.formData,"roleId",t)},expression:"formData.roleId"}})],1),e._v(" "),a("FormItem",{staticClass:"form-item",staticStyle:{"margin-bottom":"20px"},attrs:{label:"用户名：",prop:"userName"}},[a("Input",{attrs:{maxlength:20,placeholder:"请输入用户名"},model:{value:e.formData.userName,callback:function(t){e.$set(e.formData,"userName",t)},expression:"formData.userName"}})],1),e._v(" "),a("FormItem",{staticClass:"form-item",staticStyle:{"margin-bottom":"20px"},attrs:{label:"姓名：",prop:"fullName"}},[a("Input",{attrs:{maxlength:20,placeholder:"请输入姓名"},model:{value:e.formData.fullName,callback:function(t){e.$set(e.formData,"fullName",t)},expression:"formData.fullName"}})],1),e._v(" "),a("FormItem",{staticClass:"form-item",staticStyle:{"margin-bottom":"20px"},attrs:{label:"密码：",prop:"passwd"}},[a("Input",{attrs:{type:"password",maxlength:20,placeholder:"至少六位数字与字母的结合"},model:{value:e.formData.passwd,callback:function(t){e.$set(e.formData,"passwd",t)},expression:"formData.passwd"}})],1),e._v(" "),a("FormItem",{staticClass:"form-item",staticStyle:{"margin-bottom":"20px"},attrs:{label:"手机号：",prop:"phoneNumber"}},[a("Input",{attrs:{placeholder:"请输入手机号码"},model:{value:e.formData.phoneNumber,callback:function(t){e.$set(e.formData,"phoneNumber",t)},expression:"formData.phoneNumber"}})],1),e._v(" "),a("FormItem",{staticClass:"form-item",attrs:{label:"登录权限：",prop:"state"}},[a("i-switch",{model:{value:e.formData.state,callback:function(t){e.$set(e.formData,"state",t)},expression:"formData.state"}},[a("span",{attrs:{slot:"open"},slot:"open"}),e._v(" "),a("span",{attrs:{slot:"close"},slot:"close"})])],1)],1):e._e(),e._v(" "),a("div",{staticClass:"demo-drawer-footer"},[a("Button",{staticStyle:{"margin-right":"8px"},attrs:{type:"default"},on:{click:function(t){e.showDrawer=!1}}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"default",loading:e.saveLoading},on:{click:e.onSave}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"header-sub"},[t("div",{staticClass:"title"},[t("div",{staticClass:"breadcrumb-item-link"},[this._v("用户管理")])])])}]};var h=a("VU/8")(p,g,!1,function(e){a("W4Yq")},null,null).exports;t.default=h},iiIu:function(e,t){},sB8F:function(e,t,a){"use strict";var n=a("8urd"),s=a("GXH0"),o=a.n(s),l=(a("DmJO"),a("/KId"),{name:"org-select",i18n_prefix:"component.org-select",data:function(){return{treeData:[]}},props:{value:[String,Array],multiple:Boolean,label:[String,Array],includeSelf:Boolean},model:{prop:"value",event:"selection"},methods:{loadTreeData:function(){var e=this;(this.includeSelf?n.d:n.g)({level:99}).then(function(t){var a=t.data;e.treeData=function e(t){return t.map(function(t){var a=t.id,n=t.children,s={id:a+"",label:t.orgName};return n&&n.length&&(s.children=e(n)),s})}(a)})},onSelectionChange:function(e){this.$emit("selection",e),this.$emit("on-selection-change",e)}},mounted:function(){this.loadTreeData()},destroyed:function(){},components:{TreeSelect:o.a}}),r={render:function(){var e=this.$createElement;return(this._self._c||e)("TreeSelect",{staticClass:"org-select",attrs:{value:this.value,label:this.label,placeholder:this.$t_p("placeholder"),noResultsText:this.$t_p("noResultsText"),multiple:this.multiple,options:this.treeData},on:{input:this.onSelectionChange}})},staticRenderFns:[]};var i=a("VU/8")(l,r,!1,function(e){a("H/fx"),a("x8/l")},"data-v-1a1e6a87",null).exports;t.a=i},"x8/l":function(e,t){}});
//# sourceMappingURL=6.29ce36681cddf83c468b.js.map