webpackJsonp([3],{"7Ep0":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("RWfK"),n=i("//Fk"),r=i.n(n),s=i("BO1k"),o=i.n(s),l=i("Xxa5"),c=i.n(l),d=i("exGp"),u=i.n(d),h=i("BTaQ"),f=i("TVG1"),m=i("mjGd"),v=i("xV2B"),p=i("G8pB"),g={name:"single-device",components:{Select:h.Select,GraphViewer:m.a,customDrawer:p.a},data:function(){return{freshTime:[{id:"1",value:"5s"},{id:"2",value:"10s"},{id:"3",value:"60s"}],time:"5s",form:{name:"",place:""},chartId:"POWER_GENERATION_AMOUNT",formList:[{label:"导出时间段",type:"datePicker",value:"date",range:1}],formValidate:{date:[{required:!0,message:"导出时间段不能为空"}]},formValue:{},showTitle:!0,token:Object(f.g)(),disabled:!0,nameOptions:[],chartOptions:[{id:"POWER_GENERATION_AMOUNT",name:"发电量"},{id:"CARBON_EMISSIONS",name:"碳减排"},{id:"WATER_CONSUMPTION",name:"水耗"},{id:"GAS_CONSUMPTION",name:"气耗"},{id:"POWER_GENERATION_EFFICIENCY",name:"发电效率"},{id:"POWER_GENERATION",name:"发电功率"},{id:"RUN_TIME",name:"运行时长"},{id:"FAIL_NUM",name:"故障次数"},{id:"TROUBLE_FREE_OPERATION_TIME",name:"无故障运行时长"},{id:"DOWN_TIME",name:"停机次数"}],placeOptions:[],screenOptions:[{id:"1",name:"PI&D刷写状态"},{id:"2",name:"健康诊断"},{id:"3",name:"孪生应用"},{id:"4",name:"实时监测"}],isFull:!1,deviceTableColumns:[{title:"型号",key:"device",align:"left",ellipsis:!0,tooltip:!0},{title:"子系统型号",key:"subDevice",align:"left",ellipsis:!0,tooltip:!0},{title:"联系人",key:"person",align:"left",ellipsis:!0,tooltip:!0},{title:"联系方式",key:"content",align:"left",ellipsis:!0,tooltip:!0}],dangerTableColumns:[{title:"设备名称",key:"deviceName",align:"left"},{title:"告警信息",key:"errorDesc",align:"left",ellipsis:!0,tooltip:!0},{title:"告警时间",key:"alertTime",align:"left",ellipsis:!0,tooltip:!0}],deviceTableData:[{device:"111",subDevice:"111-222",person:"张三",content:"12345667885"},{device:"111",subDevice:"111-222",person:"张三",content:"12345667885"},{device:"111",subDevice:"111-222",person:"张三",content:"12345667885"},{device:"111",subDevice:"111-222",person:"张三",content:"12345667885"},{device:"111",subDevice:"111-222",person:"张三",content:"12345667885"}],dangerTableData:[],screen:"1",moduleId:"",loading:{deviceTable:!1,dangerTable:!1},deviceCurrentIndex:0,dangerCurrentIndex:0,financialList:[{id:1,name:"累计总发电",type:"POWER_TOTAL",num:"130",symbol:"kWh"},{id:2,name:"当日总发电",type:"POWER_DAILY",num:"130",symbol:"kWh"},{id:3,name:"累计上网电",type:"ONLINE_POWER_TOTAL",num:"130",symbol:"kWh"},{id:4,name:"碳减排",type:"CARBON_REDUCE_TOTAL",num:"130",symbol:"t"},{id:5,name:"累计水耗",type:"WATER_CONSUMPTION_TOTAL",num:"130",symbol:"kg"},{id:6,name:"累计气耗",type:"GAS_CONSUMPTION_TOTAL",num:"130",symbol:"m³"}],performenceList:[{id:1,name:"历史最高效率",num:"96",icon:"icon-zuigao",bg:"rgb(23, 80, 236, .2)",type:"HISTORY_MAX_POWER_EFFICIENCY",color:"#1750EC"},{id:2,name:"历史最大效率",num:"96",icon:"icon-zuida",bg:"rgba(0, 132, 255, .2)",type:"HISTORY_MAX_POWER_EFFICIENCY",color:"#0084FF"},{id:3,name:"历史平均效率",num:"96",icon:"icon-pingjun",bg:"rgba(36, 204, 53, .2)",type:"HISTORY_MAX_AVG_POWER_EFFICIENCY",color:"#24CC35"}],reliableList:[{id:1,name:"发电时长",num:"96",symbol:"/h",icon:"icon-a-guzhang2",bg:"rgba(241, 33, 33, .2)",type:"RUNTIME_TOTAL",color:"#F12121"},{id:2,name:"平均故障次数",num:"96",symbol:"/次",icon:"icon-a-lianhe62",bg:"rgba(250, 197, 22, .2)",type:"DOWN_NUM_AVG_DAILY",color:"#FAC516"},{id:3,name:"累计故障次数",num:"96",symbol:"/次",icon:"icon-shichang",bg:"rgba(255, 118, 0, .2)",type:"FAIL_NUM_TOTAL",color:"#FF7600"}],deviceId:"",parentId:""}},computed:{configurationUrl:function(){return window.location.href.split("device")[0]+"mxgraph/#/home"}},mounted:function(){var e=this;return u()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getDeviceGroup();case 2:e.getDeviceSingle(e.parentId),e.getChartType(),e.getDeviceInfo();case 5:case"end":return t.stop()}},t,e)}))()},destroyed:function(){localStorage.removeItem("freshTime")},methods:{getDeviceInfo:function(){var e=this;Object(v.t)({id:this.deviceId}).then(function(t){if(200===t.code){var i=t.data,a=!0,n=!1,r=void 0;try{for(var s,l=o()(e.financialList);!(a=(s=l.next()).done);a=!0){var c=s.value;c.num=i.economyIndex[c.type]}}catch(e){n=!0,r=e}finally{try{!a&&l.return&&l.return()}finally{if(n)throw r}}var d=!0,u=!1,h=void 0;try{for(var f,m=o()(e.performenceList);!(d=(f=m.next()).done);d=!0){var v=f.value;v.num=i.performanceIndex[v.type]}}catch(e){u=!0,h=e}finally{try{!d&&m.return&&m.return()}finally{if(u)throw h}}var p=!0,g=!1,y=void 0;try{for(var b,w=o()(e.reliableList);!(p=(b=w.next()).done);p=!0){var _=b.value;_.num=i.reliabilityIndex[_.type]}}catch(e){g=!0,y=e}finally{try{!p&&w.return&&w.return()}finally{if(g)throw y}}}}),this.loading.dangerTable=!0,Object(v._0)({deviceId:this.deviceId,pageNumber:1,pageSize:10}).then(function(t){200===t.code&&(e.dangerTableData=t.data.result,e.loading.dangerTable=!1)})},getChartType:function(){var e=this;Object(v.q)({id:this.deviceId}).then(function(t){200===t.code&&(t.data.sceneType?e.chartId=t.data.sceneType:e.chartId="POWER_GENERATION_AMOUNT",e.getChartData())})},screenChange:function(e){var t=this;if(this.screen=e,4===Number(e))Object(v.S)({id:this.deviceId}).then(function(e){200===e.code&&(t.moduleId=e.data.id,t.$refs.graphViewer.loadModuleInfo(e.data.id))});else{var i=!0,a=!1,n=void 0;try{for(var r,s=o()(this.nameOptions);!(i=(r=s.next()).done);i=!0){var l=r.value;l.deviceId===this.deviceId&&(this.moduleId=l.id,this.$refs.graphViewer.loadModuleInfo(l.id))}}catch(e){a=!0,n=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw n}}}},changeChart:function(e){Object(v.e)({deviceId:this.deviceId,sceneType:e}).then(function(e){200===e.code&&console.log("保存成功")}),this.chartId=e,this.getChartData()},freshTimeChange:function(e){localStorage.setItem("freshTime",e.slice(0,-1))},getName:function(e){var t=!0,i=!1,a=void 0;try{for(var n,r=o()(this.chartOptions);!(t=(n=r.next()).done);t=!0){var s=n.value;if(e===s.id)return s.name}}catch(e){i=!0,a=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw a}}},changeGroup:function(e){this.getDeviceSingle(e),this.getChartType()},changeSingle:function(e){var t=!0,i=!1,a=void 0;try{for(var n,r=o()(this.nameOptions);!(t=(n=r.next()).done);t=!0){var s=n.value;Number(this.form.name)===Number(s.deviceId)&&(this.deviceId=s.deviceId,this.moduleId=s.id)}}catch(e){i=!0,a=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw a}}this.screen="1",this.getDeviceInfo(),this.$forceUpdate(),this.initViewer(),this.getChartType()},confirm:function(e){var t=this,i=window.location.origin;if(e){var a={startTime:this.getRegularTime(this.formValue.date[0]),endTime:this.getRegularTime(this.formValue.date[1]),deviceId:this.deviceId};Object(v.k)(a).then(function(e){if(200===e.code){t.$Message.success("导出成功，开始下载");window.open(i+"/device-batch-ai/download/"+encodeURIComponent(e.data.fileName)),t.$refs.drawer.close()}else t.$Message.warning(e.msg)})}},getRegularTime:function(e){var t=e;return t.getFullYear().toString()+"-"+this.getString(t.getMonth()+1)+"-"+this.getString(t.getDate())+" "+this.getString(t.getHours())+":"+this.getString(t.getMinutes())+":"+this.getString(t.getSeconds())},getString:function(e){return e<10?"0"+e.toString():e.toString()},showDrawer:function(){this.$refs.drawer.open()},ChangeShow:function(e){var t=this;1===e?this.showTitle=!1:setTimeout(function(){t.showTitle=!0},2e3)},getDeviceSingle:function(e){var t=this.$route.query.deviceId,i=!0,a=!1,n=void 0;try{for(var r,s=o()(this.placeOptions);!(i=(r=s.next()).done);i=!0){var l=r.value;if(l.deviceId==e)if(l.child){this.nameOptions=l.child.map(function(e){return{name:e.unitName,id:e.mxgraphId,deviceId:e.deviceId}});var c=!0,d=!1,u=void 0;try{for(var h,f=o()(this.nameOptions);!(c=(h=f.next()).done);c=!0){var m=h.value;Number(m.deviceId)===Number(t)&&(this.form.name=m.deviceId,this.moduleId=m.id,this.deviceId=m.deviceId)}}catch(e){d=!0,u=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw u}}""===this.form.name&&(this.form.name=this.nameOptions[0].deviceId||"",this.moduleId=this.nameOptions[0].id||"",console.log(this.moduleId),this.deviceId=this.nameOptions[0].deviceId||"")}else this.nameOptions=[],this.form.name="",this.moduleId="",this.deviceId=""}}catch(e){a=!0,n=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw n}}},getDeviceGroup:function(){var e=this;return new r.a(function(t,i){var a=e.$route.query.parentId;Object(v._2)().then(function(i){var n=i.code,r=i.data;if(200===n){e.placeOptions=r.map(function(e){return{name:e.deviceName,id:e.mxgraphId,deviceId:e.deviceId,downLoadId:e.id,child:e.child}});var s=!0,l=!1,c=void 0;try{for(var d,u=o()(e.placeOptions);!(s=(d=u.next()).done);s=!0){var h=d.value;Number(h.deviceId)===Number(a)&&(e.form.place=h.deviceId,e.parentId=h.deviceId)}}catch(e){l=!0,c=e}finally{try{!s&&u.return&&u.return()}finally{if(l)throw c}}""===e.form.place&&(e.form.place=e.placeOptions[0].deviceId,e.parentId=e.placeOptions[0].deviceId),t(i)}})})},navToEdit:function(){var e="?moduleId="+this.moduleId,t="&token="+this.token,i="&deviceId=";if("4"!==this.screen){var a=!0,n=!1,r=void 0;try{for(var s,l=o()(this.nameOptions);!(a=(s=l.next()).done);a=!0){var c=s.value;c.id===this.moduleId&&(i+=c.deviceId)}}catch(e){n=!0,r=e}finally{try{!a&&l.return&&l.return()}finally{if(n)throw r}}}else i+=this.deviceId;window.open(this.configurationUrl+e+t+i,"_blank")},getChartData:function(){var e=this,t=this.deviceId,i=this.chartId;Object(v.p)({deviceId:t,businessType:i}).then(function(t){if(200===t.code){var i=t.data.indexs[0],a=i.value.map(function(e){return e.x}),n=i.legend.map(function(e){return e.name}),r=[],s=!0,l=!1,c=void 0;try{for(var d,u=o()(i.legend);!(s=(d=u.next()).done);s=!0){var h=d.value,f=[],m=!0,v=!1,p=void 0;try{for(var g,y=o()(i.value);!(m=(g=y.next()).done);m=!0){var b=g.value;f.push(b[h.key])}}catch(e){v=!0,p=e}finally{try{!m&&y.return&&y.return()}finally{if(v)throw p}}r.push(f)}}catch(e){l=!0,c=e}finally{try{!s&&u.return&&u.return()}finally{if(l)throw c}}for(var w=[],_=0;_<=r.length-1;_++){var C=e.getColors(_);w.push({name:n[_],data:r[_],type:"line",smooth:!0,itemStyle:{color:C.color},lineStyle:{color:C.color,shadowBlur:6,shadowColor:C.shadowColor,shadowOffsetY:3},emphasis:{label:{show:!0,position:"outside"}}})}var I={series:w,xData:a,legend:n};e.initChart(I)}else{e.initChart({series:[],xData:[],legend:[]})}})},getColors:function(e){switch(e){case 0:return{color:"#1CC96C",shadowColor:"rgba(255, 255, 255, 0.6)"};case 1:return{color:"#FFCE08",shadowColor:"rgba(184, 193, 29, 1)"};case 2:return{color:"#0084FF",shadowColor:"rgba(0, 0, 0, 0.16)"};case 3:return{color:"#ffb980",shadowColor:"rgba(0, 0, 0, 0.66)"}}},initChart:function(e){console.log("初始化");var t=document.getElementById("chart");this.$echarts.dispose(t),this.$echarts.init(t).setOption({xAxis:{type:"category",data:e.xData,axisLine:{lineStyle:{color:"rgba(255, 255, 255, 0.6)"}},axisLabel:{color:"rgba(255, 255, 255, 0.6)"},axisTick:{show:!1}},yAxis:{type:"value",scale:!0,splitNumber:5,axisLine:{lineStyle:{color:"rgba(255, 255, 255, 0.6)"}},axisLabel:{color:"rgba(255, 255, 255, 0.6)"},axisTick:{show:!1},splitLine:{lineStyle:{type:"dashed",color:"rgba(255, 255, 255, 0.6)"}}},grid:{bottom:20,left:60,right:0},tooltip:{show:!0,trigger:"axis"},legend:{data:e.legend,icon:"circle",itemWidth:7,itemHeight:7,right:0,textStyle:{color:"#cccc"}},series:e.series})},jump:function(){"2"===this.screen?this.$router.push({name:"health-check-list"}):"3"===this.screen&&this.$parent.changeTab(3)},fullSreen:function(){this.isFull=!this.isFull,this.initViewer()},initViewer:function(){this.$refs.graphViewer.reset()},handleClick:function(e){console.log(e)}}},y={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"single-device"},[i("div",{staticClass:"left"},[i("div",{staticClass:"left-head border"},[e._v("单机组介绍")]),e._v(" "),i("div",{staticClass:"left-device border"},[i("div",{staticClass:"form"},[i("div",{staticClass:"form-item form-item-select"},[i("div",{staticClass:"label"},[e._v("整机组")]),e._v(" "),i("div",{staticClass:"select"},[i("Select",{on:{"on-change":e.changeGroup},model:{value:e.form.place,callback:function(t){e.$set(e.form,"place",t)},expression:"form.place"}},e._l(e.placeOptions,function(t){return i("Option",{key:t.id,attrs:{value:t.deviceId}},[e._v("\n                "+e._s(t.name)+"\n              ")])}),1)],1)]),e._v(" "),i("div",{staticClass:"form-item form-item-select"},[i("div",{staticClass:"label"},[e._v("单机组名称")]),e._v(" "),i("div",{staticClass:"select"},[i("Select",{on:{"on-change":e.changeSingle},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.nameOptions,function(t){return i("Option",{key:t.id,attrs:{value:t.deviceId}},[e._v("\n                "+e._s(t.name)+"\n              ")])}),1)],1)]),e._v(" "),i("div",{staticClass:"form-item form-item-button"},[i("Button",{attrs:{type:"default"},on:{click:e.showDrawer}},[e._v("导出")])],1)])]),e._v(" "),i("div",{staticClass:"left-enivronment border"},[e.showTitle?i("div",{staticClass:"title",on:{mouseenter:function(t){e.ChangeShow(1)}}},[e._v("\n        "+e._s(e.getName(e.chartId))+"\n      ")]):e._e(),e._v(" "),e.showTitle?e._e():i("div",{staticClass:"title",on:{mouseleave:function(t){e.ChangeShow(2)}}},[i("Select",{on:{"on-change":e.changeChart},model:{value:e.chartId,callback:function(t){e.chartId=t},expression:"chartId"}},e._l(e.chartOptions,function(t){return i("Option",{key:t.id,attrs:{value:t.id}},[e._v("\n            "+e._s(t.name)+"\n          ")])}),1)],1),e._v(" "),i("div",{staticClass:"chart",staticStyle:{width:"100%",height:"200px"},attrs:{id:"chart"}})]),e._v(" "),i("div",{staticClass:"left-danger"},[i("div",{staticClass:"title"},[e._v("故障告警")]),e._v(" "),i("div",{staticClass:"left-dangertable"},[i("Table",{staticClass:"m-table no-scroll no-border",attrs:{stripe:"",loading:e.loading.dangerTable,columns:e.dangerTableColumns,"highlight-row":"",height:"400%",data:e.dangerTableData}})],1)])]),e._v(" "),i("div",{staticClass:"right"},[i("div",{class:["right-monitor",e.isFull?"active":""]},[i("div",{staticClass:"right-head"},[i("div",{staticClass:"right-head-left"},[e._v("实时监测")]),e._v(" "),i("div",{staticClass:"right-head-right"},[i("div",{staticStyle:{"margin-right":"10px"}},[e._v("刷新频率")]),e._v(" "),i("div",{staticClass:"select",staticStyle:{width:"100px"}},[i("Select",{on:{"on-change":e.freshTimeChange},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}},e._l(e.freshTime,function(t){return i("Option",{key:t.id,attrs:{value:t.value}},[e._v("\n                "+e._s(t.value)+"\n              ")])}),1)],1),e._v(" "),i("div",{staticClass:"select"},[i("Select",{on:{"on-change":e.screenChange},model:{value:e.screen,callback:function(t){e.screen=t},expression:"screen"}},e._l(e.screenOptions,function(t){return i("Option",{key:t.id,attrs:{value:t.id}},[e._v("\n                "+e._s(t.name)+"\n              ")])}),1)],1),e._v(" "),i("div",{staticClass:"jump"},[i("Button",{attrs:{type:"1"===e.screen||"4"===e.screen?"primary":"default",disabled:"1"===e.screen||"4"===e.screen,"custom-icon":"iconfont icon-tiaozhuanmianban"},on:{click:e.jump}},[e._v("跳转")])],1),e._v(" "),i("div",{staticClass:"jump"},[i("Button",{attrs:{type:"default"},on:{click:function(t){e.navToEdit()}}},[e._v("测点配置")])],1),e._v(" "),i("div",{staticClass:"full-screen"},[i("Button",{attrs:{"custom-icon":"iconfont icon-tiaozhuanmianban"},on:{click:e.fullSreen}},[e._v(e._s(e.isFull?"退出全屏":"全屏"))])],1)])]),e._v(" "),i("div",{staticClass:"right-screen"},[i("GraphViewer",{ref:"graphViewer",attrs:{"module-id":e.moduleId},on:{initViewer:function(t){e.initViewer()}}})],1)]),e._v(" "),i("div",{staticClass:"right-target"},[i("div",{staticClass:"right-target-item right-target-financial"},[i("div",{staticClass:"label"},[e._v("经济指标")]),e._v(" "),i("div",{staticClass:"content"},e._l(e.financialList,function(t){return i("div",{key:t.id,staticClass:"content-item"},[i("div",[e._v(e._s(t.name))]),e._v(" "),i("div",[i("span",{staticClass:"num"},[e._v(e._s(t.num))]),e._v(" "),i("span",{staticClass:"symbol"},[e._v("/"+e._s(t.symbol))])])])}),0)]),e._v(" "),i("div",{staticClass:"right-target-item right-target-performence"},[i("div",{staticClass:"label"},[e._v("性能指标")]),e._v(" "),i("div",{staticClass:"content"},e._l(e.performenceList,function(t){return i("div",{key:t.id,staticClass:"content-item"},[i("div",{staticClass:"icon",style:{backgroundColor:t.bg}},[i("span",{class:["iconfont",t.icon],style:{color:t.color}})]),e._v(" "),i("div",{staticClass:"data"},[i("div",[e._v(e._s(t.name))]),e._v(" "),i("div",[i("span",{staticClass:"num"},[e._v(e._s(t.num))]),e._v(" "),i("span",{staticClass:"symbol"},[e._v("/%")])])])])}),0)]),e._v(" "),i("div",{staticClass:"right-target-item right-target-reliable"},[i("div",{staticClass:"label"},[e._v("可靠性指标")]),e._v(" "),i("div",{staticClass:"content"},e._l(e.reliableList,function(t){return i("div",{key:t.id,staticClass:"content-item"},[i("div",{staticClass:"icon",style:{backgroundColor:t.bg}},[i("span",{class:["iconfont",t.icon],style:{color:t.color}})]),e._v(" "),i("div",{staticClass:"data"},[i("div",[e._v(e._s(t.name))]),e._v(" "),i("div",[i("span",{staticClass:"num"},[e._v(e._s(t.num))]),e._v(" "),i("span",{staticClass:"symbol"},[e._v(e._s(t.symbol))])])])])}),0)])])]),e._v(" "),i("custom-drawer",{ref:"drawer",attrs:{width:"500",title:"导出数据",formValidate:e.formValidate,formList:e.formList},on:{confirm:e.confirm},model:{value:e.formValue,callback:function(t){e.formValue=t},expression:"formValue"}})],1)},staticRenderFns:[]};var b=i("VU/8")(g,y,!1,function(e){i("sQFq")},"data-v-f841d47a",null).exports,w=i("Dd8w"),_=i.n(w),C=i("ooO1"),I={name:"detail-target",components:{customChart:C.a},data:function(){return{tab:1,chartList:[],deviceId:1001,deviceList:[]}},mounted:function(){this.changeTab(1),this.getSingleDevice()},methods:{getSingleDevice:function(){var e=this;Object(v.V)().then(function(t){200===t.code?e.deviceList=t.data:e.$Message.warning(t.msg)})},deviceChange:function(e){this.init(),this.getDatas(this.tab)},changeTab:function(e){var t=this;this.tab=e,this.init(),setTimeout(function(){t.changeData(e)})},init:function(){this.chartList=[]},changeData:function(e){this.getDatas(e)},getDatas:function(e){var t=this,i=this.deviceId,a=this.getType(e);Object(v.n)({deviceId:i,fieldType:a}).then(function(e){200===e.code?t.chartList=e.data.indexs.map(function(e){return{title:e.title,type:"line",xAxis:{key:"x"},yAxis:{symbol:e.unit},legend:e.legend.map(function(e,i){return _()({},e,{color:t.getColor(i)})}),value:e.value}}):(t.chartList=[],t.$Message.warning(e.msg))})},getColor:function(e){switch(e){case 0:return"#0084FF";case 1:return"#1CC96C";case 2:return"#b6a2de";case 3:return"#ffb980"}},getType:function(e){switch(e){case 1:return"ECONOMY";case 2:return"PERFORMANCE";case 3:return"RELIABILITY"}}}},x={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"detail-target"},[i("div",{staticClass:"common-flex"},[i("Select",{staticStyle:{width:"fit-content"},on:{"on-change":e.deviceChange},model:{value:e.deviceId,callback:function(t){e.deviceId=t},expression:"deviceId"}},e._l(e.deviceList,function(t){return i("Option",{key:t.deviceId,attrs:{value:t.deviceId}},[e._v("\n      "+e._s(t.deviceName)+"\n    ")])}),1),e._v(" "),i("div",{staticClass:"btnGroup"},[i("div",{style:{backgroundColor:1===e.tab?"#0084FF":"#000",color:1===e.tab?"#fff":"rgba(255,255,255,0.6)"},on:{click:function(t){e.changeTab(1)}}},[e._v("经济指标")]),e._v(" "),i("div",{style:{backgroundColor:2===e.tab?"#0084FF":"#000",color:2===e.tab?"#fff":"rgba(255,255,255,0.6)"},on:{click:function(t){e.changeTab(2)}}},[e._v("性能指标")]),e._v(" "),i("div",{style:{backgroundColor:3===e.tab?"#0084FF":"#000",color:3===e.tab?"#fff":"rgba(255,255,255,0.6)"},on:{click:function(t){e.changeTab(3)}}},[e._v("可靠性指标")])])],1),e._v(" "),i("div",{staticClass:"card-group"},e._l(e.chartList,function(t,a){return i("div",{key:a,staticClass:"card"},[i("div",{staticClass:"title"},[e._v(e._s(t.title))]),e._v(" "),i("div",{staticClass:"chart-container"},[i("custom-chart",e._b({attrs:{data:t.value,id:a,height:280}},"custom-chart",t,!1))],1)])}),0)])},staticRenderFns:[]};var T=i("VU/8")(I,x,!1,function(e){i("hrnv")},"data-v-64c4edc4",null).exports,S=i("CCvC"),O=i("mvHQ"),k=i.n(O),N={name:"chart",props:{id:{type:Number},width:{type:[String,Number],require:!0,default:"100%"},height:{type:[String,Number],require:!0,default:"20%"},legend:{type:Array,default:function(){return[]}},xAxis:{type:Object,default:function(){return{}}},yAxis:{type:Object,default:function(){return{}}},data:{type:Array,default:function(){return[]}},type:{type:String,default:function(){return""}}},data:function(){return{xAxisData:[]}},mounted:function(){this.init()},methods:{init:function(){var e=this,t=document.getElementById("chart-"+this.id),i=this.$echarts.init(t);i.setOption(this.options),i.on("mouseover",function(t){e.mouseover(t,i)}),i.on("mouseout",function(t){e.mouseout(t,i)}),this.$emit("init",!0)},mouseover:function(e,t){this.xAxisData=this.options.xAxis.data;var i=this.options.xAxis.data.map(function(t){return t===e.name?t={value:e.name,textStyle:{fontWeight:"bold",color:"#fff"}}:t});t.setOption({xAxis:{data:i}})},mouseout:function(e,t){t.setOption({xAxis:{data:this.xAxisData}})},dataType:function(e){return Object.prototype.toString.call(e)}},computed:{options:function(){var e=this,t={xAxis:{type:"category",data:this.data.map(function(t){return t[e.xAxis.key]}),axisLine:{lineStyle:{color:"rgba(255,255,255,0.6)"}},axisLabel:{color:"rgba(255,255,255,0.6)"},axisTick:{show:!1}},position:function(e,t,i,a,n){var r=e[0],s=n.contentSize[0];return[s<=r?r-s:r,50]},tooltip:{trigger:"axis"},yAxis:{type:"value",name:this.yAxis&&this.yAxis.symbol,nameTextStyle:{color:"rgba(255,255,255,0.6)",padding:[0,0,-5,-20]},splitNumber:2,axisLine:{lineStyle:{color:"rgba(255,255,255,0.6)"}},axisTick:{show:!1},axisLabel:{color:"rgba(255,255,255,0.6)"},splitLine:{lineStyle:{type:"dashed",color:"rgba(255,255,255,0.0784313725490196)"}}},grid:{top:"50",bottom:"15%",left:"47",right:"20"},legend:this.legend.length>1?{data:this.legend.map(function(e){return e.name}),icon:"circle",itemWidth:7,itemHeight:7,right:0,textStyle:{color:"#cccc"}}:{show:!1},series:this.legend.map(function(t){return"line"===e.type?{name:t.name,type:e.type,data:e.data.map(function(e){return e[t.key]}),smooth:!0,itemStyle:{color:t.color},lineStyle:{color:t.color,shadowBlur:6,shadowColor:"rgba(0, 0, 0, 0.16)",shadowOffsetY:3},toolTip:{show:!0},emphasis:{label:{show:!0,position:"outside"}}}:"bar"===e.type?{name:t.name,type:e.type,barWidth:8,barGap:0,showBackground:!0,data:e.data.map(function(e){return e[t.key]}),smooth:!0,itemStyle:{color:t.color},backgroundStyle:{color:"#F0F3F8"},emphasis:{label:{show:!0,position:"outside"}}}:void 0})};return t}}},E={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"chart",attrs:{id:"chart-"+this.id}})},staticRenderFns:[]};var L=i("VU/8")(N,E,!1,function(e){i("gZy6")},"data-v-9a55dd6c",null).exports,A={name:"detail-target",components:{customChart:L},props:{selfId:{type:Number},showBtn:{default:!1},info:{type:Object},list:{type:Array}},computed:{infoTemp:function(){return this.info}},data:function(){return{chartInfo:{device:this.info.deviceUnitName,title:this.info.pointName,btn:this.info.btn,type:"line",xAxis:{key:"timestamp"},yAxis:{symbol:this.info.unitName},legend:[{key:"value",color:"#0084FF"}],grid:{top:"15",bottom:"0",left:"15",right:"100"}}}},mounted:function(){this.getInfo()},methods:{deleteChild:function(){this.$emit("deleteItem",this.selfId)},editChild:function(){},getSimple:function(){var e=this.list[this.list.length>0?this.list.length-1:0]&&this.list[this.list.length>0?this.list.length-1:0].value;return e?Number(e).toFixed(2):"0.00"},init:function(e){this.$emit("init",e)},getInfo:function(){var e=this.info,t=e.deviceUnitName,i=e.unitName,a=e.pointName;this.chartInfo={device:t,title:a,type:"line",xAxis:{key:"timestamp"},yAxis:{symbol:i},legend:[{key:"value",color:"#0084FF"}],grid:{top:"15",bottom:"0",left:"15",right:"100"}},this.$refs.chart&&this.$refs.chart.init()}}},F={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"card"},[i("div",{staticClass:"title-line"},[i("div",{staticClass:"title"},[e._v(e._s(e.infoTemp.deviceUnitName))]),e._v(" "),e.infoTemp.btn?i("Button",{staticClass:"btn-delete",on:{click:e.deleteChild}},[e._v("刪除")]):e._e()],1),e._v(" "),i("div",{staticClass:"chart-container"},[i("div",{staticClass:"title"},[e._v(e._s(e.infoTemp.pointName))]),e._v(" "),i("div",{staticClass:"lastInfo"},[e._v(e._s(e.getSimple()))]),e._v(" "),i("custom-chart",e._b({ref:"chart",attrs:{data:e.list,id:e.selfId,height:134},on:{init:e.init}},"custom-chart",e.chartInfo,!1))],1)])},staticRenderFns:[]};var $=i("VU/8")(A,F,!1,function(e){i("VZ3d")},"data-v-01e7818f",null).exports,D={name:"detail-target",components:{customChart:C.a},props:{chartList:{type:Array},data:{type:Object}},data:function(){return{temp:{},height:"300",width:"700"}},mounted:function(){if(this.$refs.chart){1===this.$refs.chart.length&&(this.height="580%"),this.$refs.chart.length<=2&&(this.width="1500");var e=!0,t=!1,i=void 0;try{for(var a,n=o()(this.$refs.chart);!(e=(a=n.next()).done);e=!0){a.value.init({height:this.height,width:this.width})}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},computed:{chartInfo:{get:function(){return JSON.parse(k()(this.chartList))},set:function(e){return e}},list:{get:function(){return JSON.parse(k()(this.data))},set:function(e){return JSON.parse(k()(e))}}},methods:{init:function(e){var t=e.chartList,i=e.data;if(this.chartInfo=JSON.parse(k()(t)),this.list=i,this.$refs.chart){var a=!0,n=!1,r=void 0;try{for(var s,l=o()(this.$refs.chart);!(a=(s=l.next()).done);a=!0){s.value.init()}}catch(e){n=!0,r=e}finally{try{!a&&l.return&&l.return()}finally{if(n)throw r}}}}}},M={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"detail-target"},[i("div",{staticClass:"card-group"},e._l(e.chartInfo,function(t,a){return i("div",{key:a,staticClass:"card",staticStyle:{width:"100%"}},[i("div",{staticClass:"title"},[e._v(e._s(t.title))]),e._v(" "),i("div",{staticClass:"chart-container",staticStyle:{height:"100%",width:"100%"}},[i("custom-chart",e._b({ref:"chart",refInFor:!0,attrs:{data:e.list[t.value],id:Number(t.id),height:e.height,showLegend:!0},on:{init:e.init}},"custom-chart",t,!1))],1)])}),0)])},staticRenderFns:[]};var R=i("VU/8")(D,M,!1,function(e){i("kmGJ")},"data-v-614fb45c",null).exports,V={name:"detail-target",components:{customChart:L,singleChart:$},props:{info:{},type:{type:Array}},data:function(){return{carouselValue:0,autoplay:!1,search:{dimension:"min",deviceUnit:"",name:""},speed:1e4,tab:1,list:[],views:[{name:"100ms",id:"mill"},{name:"1min",id:"min"},{name:"1h",id:"hour"}],newArr:[],timer:{},ids:[]}},mounted:function(){this.getChartIds()},watch:{list:function(e){var t=this;e.length<=3&&this.timer==={}&&(this.timer=setInterval(function(){t.newArr=[],t.getCharts(t.ids,1)},1e4))}},destroyed:function(){this.timer&&clearInterval(this.timer)},methods:{changeCarousel:function(e,t){this.newArr[t].length<3&&(this.carouselValue=0),t%2!=0&&(!this.ids[6*t+6]&&this.ids[6*t]?this.getCharts(this.ids.slice(6*t),2):this.ids[6*t+6]||this.ids[6*t]?this.getCharts(this.ids.slice(6*t,6*t+6),2):(this.newArr=[],this.getCharts(this.ids.slice(0,6),1)))},getChartIds:function(){var e=this;this.autoplay=!1;var t=this.search,i=t.name,a=t.deviceUnit;Object(v.G)({pointType:this.info.type,indexName:i,deviceUnit:a}).then(function(t){var n=t.code,r=t.data;if(200===n&&r[0]&&r[0].pointTypeList){var s=r[0].pointTypeList,l=[],c=!0,d=!1,u=void 0;try{for(var h,f=o()(s);!(c=(h=f.next()).done);c=!0){var m=h.value;l.push(m.id)}}catch(e){d=!0,u=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw u}}e.ids=l,e.newArr=[],e.getCharts(l.slice(0,6),1),(i||a)&&(e.carouselValue=0)}})},getCharts:function(e,t){var i=this,a=e.join(",");Object(v.o)({indexId:a,timeType:this.search.dimension}).then(function(e){var a=e.code,n=e.data;if(200===a){i.list=n.map(function(e){return _()({},e,{datas:e.datas?e.datas.map(function(e,t){return{value:Number(e.value).toFixed(2),timestamp:i.changeTimestamp(i.search.dimension,e.timestamp,t)}}):[]})});for(var r=0,s=0;s<i.list.length;s++)s%3==0&&0!==s&&0!==i.list.slice(r,s).length&&(i.newArr.push(i.list.slice(r,s)),r=s),s+1===i.list.length&&0!==i.list.slice(r,s+1).length&&i.newArr.push(i.list.slice(r,s+1));i.$nextTick(function(){if(i.$refs.chart){var e=!0,a=!1,n=void 0;try{for(var r,s=o()(i.$refs.chart);!(e=(r=s.next()).done);e=!0){r.value.getInfo()}}catch(e){a=!0,n=e}finally{try{!e&&s.return&&s.return()}finally{if(a)throw n}}i.autoplay=!0,1===t&&(i.carouselValue=0)}})}})},init:function(e){this.autoplay=e},changeTimestamp:function(e,t,i){if(!t)return"100";if(0===Number(i))switch(e){case"min":return t.slice(8,10)+":"+t.slice(10,12);case"hour":return t.slice(8,10);case"mill":return t.slice(10,12)+":"+t.slice(12,14)+":"+t.slice(-3)}switch(e){case"min":return t.slice(10,12);case"hour":return t.slice(8,10);case"mill":return t.slice(-3)}},drag:function(e){},dragend:function(e){console.log(e),this.$emit("dragInfo",e.target.id)},viewChange:function(e,t){clearInterval(this.timer),this.timer={},this.getChartIds()}}},G={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"common-box"},[i("div",{staticClass:"left-control"},[i("div",{staticClass:"unit"},[e._v(e._s(e.info.name))]),e._v(" "),i("Select",{staticStyle:{width:"100px","margin-bottom":"6px","font-size":"12px"},on:{"on-change":function(t){e.viewChange(t,1)}},model:{value:e.search.deviceUnit,callback:function(t){e.$set(e.search,"deviceUnit",t)},expression:"search.deviceUnit"}},e._l(e.type,function(t){return i("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1),e._v(" "),i("Select",{staticStyle:{width:"100px","margin-bottom":"6px"},on:{"on-change":function(t){e.viewChange(t,2)}},model:{value:e.search.dimension,callback:function(t){e.$set(e.search,"dimension",t)},expression:"search.dimension"}},e._l(e.views,function(t){return i("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1),e._v(" "),i("Input",{staticStyle:{width:"100px"},attrs:{placeholder:"输入名称"},on:{"on-enter":function(t){e.viewChange(t,3)},"on-click":function(t){e.viewChange(t,3)}},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}})],1),e._v(" "),e.autoplay?e._e():i("div",{staticClass:"loading"},[i("Icon",{staticStyle:{animation:"ani-demo-spin 1s linear infinite"},attrs:{type:"ios-loading"}})],1),e._v(" "),i("Carousel",{staticClass:"moveBox",attrs:{autoplay:e.autoplay,dots:"none",value:e.carouselValue,"autoplay-speed":e.speed},on:{"on-change":e.changeCarousel}},e._l(e.newArr,function(t,a){return i("CarouselItem",{key:a,staticStyle:{display:"flex"}},e._l(t,function(t,a){return i("div",{key:a,staticClass:"droppable-element",attrs:{draggable:"true",unselectable:"on",id:t.indexId},on:{drag:e.drag,dragend:e.dragend}},[i("single-chart",{ref:"chart",refInFor:!0,attrs:{list:t.datas,selfId:t.indexId,info:t},on:{init:e.init}})],1)}),0)}),1)],1)},staticRenderFns:[]};var U={name:"orignal-data",components:{customChart:L,singleChart:$,chartGroup:i("VU/8")(V,G,!1,function(e){i("ZayF")},"data-v-34050d0e",null).exports,compileChart:R},data:function(){return{formList:[{label:"精度",type:"select",value:"type",data:[{value:"1",name:"1min"},{value:"2",name:"1hour"},{value:"3",name:"100ms"}]},{label:"导出时间段",type:"datePicker",value:"date",range:1}],formValidate:{type:[{required:!0,message:"请选择精度"}],date:[{required:!0,message:"导出时间段不能为空"}]},formValue:{},showFree:"min",tab:2,showList:[],layout:[],typeList:[{name:"温度℃",type:"TEMPERATURE"},{name:"电压V",type:"VOLTAGE"},{name:"压力mbar",type:"PRESSURE"},{name:"电流A",type:"CURRENT"},{name:"流量mg/s",type:"FLOW"},{name:"功率KW",type:"POWER"}],machineType:[],layoutStore:[],draggable:!1,ids:[],sortArr:[],fullScreen:!1,views:[{name:"100ms",id:"mill"},{name:"1min",id:"min"},{name:"1h",id:"hour"}],chartList:[],infoData:{}}},mounted:function(){this.getType()},methods:{confirm:function(){},getCharts:function(e){var t=this;return new r.a(function(i,a){e&&t.ids.push(e),t.layout=[],t.layoutStore=[];var n=t.ids.join(",");Object(v.o)({indexId:n,timeType:t.showFree}).then(function(e){var n=e.code,r=e.data;if(200===n){var s=!0,l=!1,c=void 0;try{for(var d,u=o()(r);!(s=(d=u.next()).done);s=!0){var h=d.value;t.layout.push(_()({},h,{btn:!0,datas:h.datas.map(function(e,i){return{value:e.value,timestamp:t.changeTimestamp(t.showFree,e.timestamp,i)}}),x:t.layout.length,i:t.layout.length.toString()}))}}catch(e){l=!0,c=e}finally{try{!s&&u.return&&u.return()}finally{if(l)throw c}}i(e)}else a(e)})})},dragInfo:function(e){6===this.layout.length?this.$Message.warning("已达拖拽数量上限"):this.ids.includes(e)?this.$Message.warning("该图表已在自由展示区"):this.getCharts(e)},deleteItem:function(e){var t=e-1e7;for(var i in this.layout){this.layout[i].indexId===t&&(this.layout.splice(Number(i),1),this.layoutStore=this.clone(this.layout))}for(var a in this.ids){var n=this.ids[a];Number(n)===Number(t)&&this.ids.splice(Number(a),1)}},changeTimestamp:function(e,t,i){if(!t)return"100";if(0===Number(i))switch(e){case"min":return t.slice(8,10)+":"+t.slice(10,12);case"hour":return t.slice(8,10);case"mill":return t.slice(10,12)+":"+t.slice(12,14)+":"+t.slice(-3)}switch(e){case"min":return t.slice(10,12);case"hour":return t.slice(8,10);case"mill":return t.slice(-3)}},getType:function(){var e=this;Object(v.I)().then(function(t){var i=t.code,a=t.data;200===i&&(e.machineType=a.map(function(e){return{name:e.unitName,id:e.id}}))})},freeViewChange:function(){var e=this;this.ids.length>0&&this.getCharts().then(function(){e.fullScreen&&e.compileChart()})},changeScreen:function(e){if(0!==this.layout.length||1===e){this.layoutStore=JSON.parse(k()(this.layout)),!1===this.fullScreen?this.compileChart():(this.layout=this.layoutStore,this.infoData={},this.chartList=[]);var t=document.getElementsByClassName("detail-target");t[0]&&(t[0].scrollTop=0),this.fullScreen=1!==e&&!this.fullScreen}else this.$Message.warning("请至少拖拽一张图表")},compileChart:function(){var e=this,t=[],i=[],a={},n=[],r=!0,s=!1,l=void 0;try{for(var c,d=o()(["℃","V","mbar","A","mg/s","kw"]);!(r=(c=d.next()).done);r=!0){var u=c.value,h=!0,f=!1,m=void 0;try{for(var v,p=o()(this.layout);!(h=(v=p.next()).done);h=!0){var g=v.value;g.unitName===u&&t.push(g)}}catch(e){f=!0,m=e}finally{try{!h&&p.return&&p.return()}finally{if(f)throw m}}}}catch(e){s=!0,l=e}finally{try{!r&&d.return&&d.return()}finally{if(s)throw l}}for(var y in t){var b=t[y],w=t[Number(y)+1];w&&b.unitName!==w.unitName&&i.push(Number(y))}for(var _ in i.includes(5)||i.splice(i.length,0,5),i){for(var C=[],I="",x="",T="",S=Number(_),O=i[_],k=i[S>0?S-1:0],N=0===S?0:k+1,E=S===i.length-1?t.length-1:O,L=0,A="";N<=E;N++){var F=this.clone(t[N]);I=this.getTitle(F.unitName),x=this.getValue(F.unitName),T=F.unitName;var $=this.getColorAndKey(L),D=$.color,M=$.key,R=F.deviceUnitName+F.pointName;for(var V in C.push({name:R,key:M,color:D}),A+=F.indexId,F.datas){var G=F.datas[V];a[""+x]||(a[""+x]=[]),a[""+x][V]||(a[""+x][V]={}),a[""+x][V].timestamp=G.timestamp,a[""+x][V][""+M]=G.value}L++}n.push({title:I,id:A,type:"line",xAxis:{key:"timestamp"},yAxis:{symbol:T},legend:C,value:x})}this.infoData=a,this.chartList=n,this.$refs.complieChart&&this.$nextTick(function(){e.$refs.complieChart.init({data:a,chartList:n})})},clone:function(e){return JSON.parse(k()(e))},getColorAndKey:function(e){switch(e){case 0:return{color:"#0084FF",key:"one"};case 1:return{color:"#1CC96C",key:"two"};case 2:return{color:"#b6a2de",key:"three"};case 3:return{color:"#ffb980",key:"four"};case 4:return{color:"#FFFF00",key:"five"};case 5:return{color:"#FFC0CB",key:"six"}}},getTitle:function(e){switch(e){case"℃":return"温度";case"V":return"电压";case"mbar":return"压力";case"A":return"电流";case"mg/s":return"流量";case"kw":return"功率"}},getValue:function(e){switch(e){case"℃":return"temperature";case"V":return"voltage";case"mbar":return"pressure";case"A":return"current";case"mg/s":return"flow";case"kw":return"power"}},clearLayout:function(){this.layout=[],this.infoData={},this.ids=[],this.layoutStore=[]},changeTab:function(e){this.tab=e,this.changeScreen(1)},addChart:function(e){}}},j={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"detail-target",style:{overflow:e.fullScreen?"hidden":"scroll"}},[i("div",{staticClass:"tab"},[i("div",{staticClass:"btn",style:{backgroundColor:1===e.tab?"#0084FF":"#000"},on:{click:function(t){e.changeTab(1)}}},[e._v("遥信")]),e._v(" "),i("div",{staticClass:"btn",style:{backgroundColor:2===e.tab?"#0084FF":"#000"},on:{click:function(t){e.changeTab(2)}}},[e._v("遥测")])]),e._v(" "),i("div",{staticClass:"common-flex",style:{height:e.fullScreen?"92%":"190px",marginBottom:e.fullScreen?"10px":"0"}},[i("div",{staticClass:"changeView"},[i("div",{staticStyle:{"margin-bottom":"10px"}},[e._v("自由展示区")]),e._v(" "),i("Select",{staticStyle:{width:"100px","margin-bottom":"12px"},on:{"on-change":e.freeViewChange},model:{value:e.showFree,callback:function(t){e.showFree=t},expression:"showFree"}},e._l(e.views,function(t){return i("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1),e._v(" "),e.fullScreen?i("Button",{staticStyle:{width:"100px"},attrs:{type:"default"},on:{click:e.changeScreen}},[i("span",{staticClass:"iconfont icon-tuichu"}),e._v("退出")]):e._e()],1),e._v(" "),i("div",{staticClass:"grid",style:{width:e.fullScreen?"1494px":"1386px",height:e.fullScreen?"98%":"100%"}},[e._l(e.layout,function(t,a){return i("div",{directives:[{name:"show",rawName:"v-show",value:!e.fullScreen,expression:"!fullScreen"}],key:a},[i("single-chart",{ref:"chart",refInFor:!0,attrs:{list:t.datas,selfId:t.indexId+1e7,info:t},on:{deleteItem:e.deleteItem}})],1)}),e._v(" "),e.fullScreen?i("compile-chart",{ref:"complieChart",attrs:{data:e.infoData,chartList:e.chartList}}):e._e()],2),e._v(" "),e.fullScreen?e._e():i("div",{staticClass:"changeBtn"},[i("Button",{staticStyle:{"margin-bottom":"12px"},attrs:{type:"default"},on:{click:e.clearLayout}},[i("span",{staticClass:"iconfont icon-qingkong",staticStyle:{"margin-right":"14px",width:"100px"}}),e._v("清空")]),e._v(" "),e.fullScreen?e._e():i("Button",{attrs:{type:"primary"},on:{click:e.changeScreen}},[i("span",{staticClass:"iconfont icon-quanping",staticStyle:{"margin-right":"14px",width:"100px"}}),e._v(e._s(e.fullScreen?"退出全屏":"全屏"))])],1)]),e._v(" "),e.fullScreen?e._e():i("div",{staticClass:"flow"},e._l(e.typeList,function(t,a){return i("div",{key:a},[i("chart-group",{attrs:{info:t,type:e.machineType},on:{dragInfo:e.dragInfo}})],1)}),0)])},staticRenderFns:[]};var B=i("VU/8")(U,j,!1,function(e){i("CRRU")},"data-v-9d336812",null).exports,P={name:"orignal-data",components:{},data:function(){return{suanpanLink:""}},mounted:function(){this.getTwin()},methods:{getTwin:function(){var e=this;Object(v.Y)().then(function(t){200===t.code?e.suanpanLink=t.data:e.$Message.warning(t.msg)})}}},Y={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"detail-target"},[t("iframe",{staticStyle:{width:"102.5%",height:"100%"},attrs:{src:this.suanpanLink,frameborder:"0"}})])},staticRenderFns:[]};var W=i("VU/8")(P,Y,!1,function(e){i("eoLY")},"data-v-61e2f435",null).exports,H={name:"platform",components:{tab:a.a,singleDevice:b,detailTarget:T,orignalData:B,twinApplication:W},mixins:[S.a],data:function(){return{tabList:[{id:1,name:"单机组概况",com:b},{id:2,name:"统计指标",com:T},{id:3,name:"原始数据",com:B},{id:4,name:"孪生应用",com:W}],tabIndex:0,is:null}},created:function(){this.is=this.tabList[this.tabIndex].com},methods:{changeTab:function(e){console.log(e),this.tabIndex=e,this.is=this.tabList[e].com}}},z={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"single-device"},[t("tab",{attrs:{data:this.tabList,current:this.tabIndex},on:{change:this.changeTab}}),this._v(" "),t("div",{staticClass:"content"},[t("transition",{attrs:{"enter-active-class":this.routerTransitionClass.enter,"leave-active-class":this.routerTransitionClass.leave}},[t(this.is,{tag:"component"})],1)],1)],1)},staticRenderFns:[]};var q=i("VU/8")(H,z,!1,function(e){i("J1VK")},"data-v-107159b6",null).exports;t.default=q},CRRU:function(e,t){},J1VK:function(e,t){},VZ3d:function(e,t){},ZayF:function(e,t){},"aAh+":function(e,t){},c42R:function(e,t){},eoLY:function(e,t){},gZy6:function(e,t){},hrnv:function(e,t){},kmGJ:function(e,t){},mjGd:function(e,t,i){"use strict";var a=i("mvHQ"),n=i.n(a),r=i("Dd8w"),s=i.n(r),o=i("//Fk"),l=i.n(o),c=i("E4Tp"),d=i("XLwt"),u=i.n(d),h=i("qgvZ"),f=i("P9l9"),m=i("xV2B"),v=i("TVG1"),p=i("PJh5"),g=i.n(p),y={name:"graph-viewer",i18n_prefix:"component.graph-viewer",components:{CommonLoading:c.a,ChartBase:h.a},props:{moduleId:{type:[String,Number]},background:{type:String},zoomEnable:{type:Boolean,default:function(){return!1}},panEnable:{type:Boolean,default:function(){return!1}}},data:function(){return{LoadComplete:!1,timeRange:[g()().add(-1,"d").format("YYYY-MM-DD HH:mm:ss"),g()().format("YYYY-MM-DD HH:mm:ss")],showInfo:!1,tipPosition:null,showEdit:!1,showView:!1,planSaving:!1,viewer:null,_fla:!1,flag:0,InfoRules:{},currentEdit:{},currentModuleInfo:{},currentGraphInfo:null,scale:1,itemRefreshTimer:null,showModuleId:[],chartLoading:!1,chartOptions:{},historyData:[]}},computed:{tipStyle:function(){return this.tipPosition?{display:"block",left:this.tipPosition[0]+"px",top:this.tipPosition[1]+"px"}:{display:"none"}},graphStyle:function(){return this.currentGraphInfo?{width:"auto !important",background:"black"}:{width:"auto !important"}}},watch:{showModuleId:function(e){e&&e.length&&this.loadModuleInfo(e[e.length-1])},moduleId:function(e){this.showModuleId=[],this.loadModuleInfo(e)}},methods:{showTip:function(e,t){this.tipPosition=[e+10,t]},hideTip:function(){this.tipPosition=null},initViewer:function(){var e=this;return new l.a(function(t,i){mxUtils.get("./static/vendor/mxgraph/default.xml",function(i){var a=new Object;a[Graph.prototype.defaultThemeName]=i.getDocumentElement();var n=e.viewer=new Graph(e.$refs.graph,void 0,void 0,void 0,a);function r(e,t){try{if(t.getStyle().includes("shape=flowLine")){var i=e.view.getState(t).shape.node;i.getElementsByTagName("path")[0].removeAttribute("visibility"),i.getElementsByTagName("path")[0].setAttribute("stroke-width","6"),i.getElementsByTagName("path")[0].setAttribute("stroke","white"),i.getElementsByTagName("path")[1].setAttribute("class","flow")}}catch(e){}}if(n.resizeContainer=!0,n.setEnabled(!1),n.addListener(mxEvent.REFRESH,function(e,t){e.view.states.visit(function(t,i){e.model.isEdge(i.cell)&&r(e,i.cell)})}),n.addListener(mxEvent.SIZE,function(e,t){e.view.states.visit(function(t,i){e.model.isEdge(i.cell)&&r(e,i.cell)})}),n.addListener(mxEvent.CELLS_ADDED,function(e,t){var i=t.properties.cells[0];i&&i.isEdge()&&r(e,i)}),e.zoomEnable&&e.$refs.graph.addEventListener("mousewheel",function(e){if(e.preventDefault(),e.stopPropagation(),e.wheelDelta>100){n.zoom(1.1)}else if(e.wheelDelta<-100){n.zoom(.9)}},{passive:!1}),e.panEnable){var s=!1,o=void 0;e.$refs.graph.addEventListener("mousedown",function(e){s=!0,o=e}),e.$refs.graph.addEventListener("mousemove",function(e){if(s)if(o){var t=e.clientX-o.clientX,i=e.clientY-o.clientY;n.panGraph(t,i)}else;}),e.$refs.graph.addEventListener("mouseup",function(e){s=!1,o=null}),e.$refs.graph.addEventListener("mouseleave",function(e){s=!1,o=null})}t(n)},function(){i()})})},onPlanSave:function(){this.editCmd(this.currentEdit),this.showEdit=!1},updateGraphInfo:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=mxUtils.parseXml(t),a=/pageWidth="(\d+)".*pageHeight="(\d+)"/.exec(t)||[],n=void 0;a[1]&&a[2]&&(n={pageWidth:1*a[1],pageHeight:1*a[2]});var r=new mxCodec(i);this.currentGraphInfo=r.decode(i.documentElement,this.viewer.getModel()),this.refreshScale(n).then(function(){e.showView=!!n})},loadModuleInfo:function(e){var t=this;e||(e=this.showModuleId.length?this.showModuleId[this.showModuleId.length-1]:this.moduleId),e&&(this.showView=!1,Object(f.d)({id:e}).then(function(e){t.currentModuleInfo=e.data||{},t.updateGraphInfo(t.currentModuleInfo.xmlstring||""),1===t.currentModuleInfo.type?t.startGraphRefresh():t.stopGraphRefresh(),t.LoadComplete=!0},function(e){t.$Message.error(t.$t_p("get_fail"))}))},refreshScale:function(e){var t=this;return new l.a(function(i,a){clearTimeout(t.refreshTimer),t.refreshTimer=setTimeout(function(){e||(e=t.currentGraphInfo);var n=t.$refs&&t.$refs.viewer;if(e&&e.pageWidth&&e.pageHeight&&n){var r=n.clientWidth,s=n.clientHeight,o=Math.abs(t.currentGraphInfo._pageWidth||t.viewer.view.graphBounds.width+2*t.viewer.view.graphBounds.x),l=Math.abs(t.currentGraphInfo._pageHeight||t.viewer.view.graphBounds.height+2*t.viewer.view.graphBounds.y),c=1;c=r/s>o/l?s/l:r/o,t.currentGraphInfo._pageWidth=o,t.currentGraphInfo._pageHeight=l,t.viewer.zoomTo(c,!1),t.scale=c,i()}else a&&a()},10)}).catch(function(e){})},startGraphRefresh:function(){var e=this;if(this.stopGraphRefresh(),this.refreshGraphDataView(),this.currentModuleInfo.refreshInterval){var t=localStorage.getItem("freshTime")?1e3*Number(localStorage.getItem("freshTime")):5e3;this.itemRefreshTimer=setInterval(function(){e.refreshGraphDataView()},t)}},stopGraphRefresh:function(){clearInterval(this.itemRefreshTimer)},getItemId:function(e){var t=e.detail.itemName;if(t){var i=t.split("(");if(i){var a=i[1].split(")");if(a)return a[0]}}return 0},refreshGraphDataView:function(){var e=this.viewer,t=e.getModel(),i=[],a={};for(var n in t.cells){var r=Object(v.b)(t.cells[n],{graph:e});if("1"===r.detail.type){var o=r.detail.deviceId+"-"+r.detail.item;if(a[o])a[o].push(t.cells[n]);else{var l=this.getItemId(r);a[o]=[t.cells[n]],i.push({itemId:l,deviceId:r.detail.deviceId})}}}i.length&&Object(f.b)({items:i}).then(function(t){(t.data||[]).forEach(function(t){var i=t.deviceId+"-"+t.itemId;a[i]&&a[i].forEach(function(i){var a=Object(v.b)(i,{graph:e}),n=["true","1"].includes(a.detail.bindText+"");if(i.setAttribute("xl-bind-itemVal",t.val),n){var r=null==t.val?"":t.val+"";if(r){r=Number(r);var o=a.detail||{},l=o.bindTextOp,c=void 0===l?"*":l,d=o.bindTextOpValue,u=Number(void 0===d?1:d);switch(c){case"*":r*=u;break;case"/":r/=u;break;case"+":r+=u;break;case"-":r-=u}a.valueFixed&&(r=r.toFixed(a.valueFixed))}i.setAttribute("label",r)}if(a.detail.mapping&&a.detail.mapping.length){var h=a.detail.mapping.map(function(e){return s()({},e,{x1:e.x1?e.x1:0===e.x1?e.x1:1})});Object(v.i)(i,h,t)}})}),e.refresh()})},reload:function(){this.loadModuleInfo()},reset:function(){var e=[].concat(this.showModuleId);e.pop(),this.showModuleId=e,0===e.length&&this.loadModuleInfo(this.moduleId)},editCmd:function(e){var t=this;Object(f.a)(e).then(function(e){t.$Message.success(e.data)},function(e){1e3==e.code?t.$Message.error(e.msg):t.$Message.error(t.$t_p("order_issue_fail"))})},getChartSeries:function(e,t){return{name:t,type:"line",showSymbol:!1,lineStyle:{normal:{color:"#00c1de"}},itemStyle:{show:!1,normal:{color:"#00c1de"}},areaStyle:{normal:{color:new u.a.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#f8fafa"},{offset:1,color:"#ecf7f8"}])}},data:e}},getChartGrid:function(e){var t=0;return e.forEach(function(e){t=Math.max(t,Math.abs(e.value[1]))}),{left:t=12*t.toFixed(0).length+30,right:"5%",top:30,bottom:80}},loadDeviceItemsHistoryData:function(e,t,i){var a=this;this.chartLoading=!0;var n=this.timeRange[0],r=this.timeRange[1];n&&(n=g()(n).format("YYYY-MM-DD HH:mm:ss")),r&&(r=g()(r).format("YYYY-MM-DD HH:mm:ss"));var o={deviceId:e,itemId:t,sDate:n,eDate:r};Object(m.v)(s()({},o)).then(function(e){a.historyData=(e.data.result||[]).map(function(e){return s()({},e,{dateTime:e.dateTime||e.dataTime})}),a.chartLoading=!1,a.refreshChart(i)})},refreshChart:function(e){var t=[];[].concat(this.historyData).reverse().forEach(function(e){var i=g()(e.dateTime);t.push({name:i.toDate(),value:[i.toDate(),Number(e.val||0)]})}),this.chartOptions={calculable:!1,animation:!1,tooltip:{trigger:"axis",position:function(e){return[e[0],"10%"]}},title:{left:"center",text:""},grid:this.getChartGrid(t),xAxis:{type:"time",axisTick:{show:!1,lineStyle:{color:"#00c1de"}},axisLine:{lineStyle:{color:"#878787"}},splitLine:{show:!1}},yAxis:{type:"value",axisTick:{show:!1},axisLine:{lineStyle:{color:"#878787"}},splitLine:{show:!1}},series:[this.getChartSeries(t,e)]}}},mounted:function(){var e=this;this.initViewer().then(function(t){new mxCellTracker(t).mouseMove=function(e,i){var a=i.sourceState&&i.sourceState.cell;if(a){var n=Object(v.c)(a),r=Object(v.b)(a,{graph:t});if(2==n&&i.getState().setCursor("pointer"),r.detail&&4==r.detail.cmdType){var s=r.detail.infoName?r.detail.infoName:"";-1!=s.indexOf("group")&&i.getState().setCursor("pointer"),-1!=s.indexOf("item")&&i.getState().setCursor("pointer")}}},t.getTooltipForCell=function(t){var i=Object(v.c)(t),a=Object(v.b)(t,{graph:e.viewer});if(2==i)return"点击跳转到组态 "+a.detail.moduleName;if(a.detail&&4==a.detail.cmdType){var n=a.detail.infoName?a.detail.infoName:"";if(-1!=n.indexOf("group"))return"点击跳转到设备组详情";if(-1!=n.indexOf("item"))return"点击获取测点数据"}},t.click=function(i){if(e.$hasAccess("dev.edit")){var a=i.sourceState&&i.sourceState.cell;if(a){var r=Object(v.b)(a,{graph:t});if(r.detail&&0==r.detail.cmdType||1==r.detail.cmdType){var o={};o.args=r.detail.cmdType,o.devices=r.detail.devices,o.bindTime=r.detail.bindTime||10,e.currentEdit=s()({},o),e.editCmd(e.currentEdit)}if(r.detail&&2==r.detail.cmdType){var l={};l.devices=r.detail.devices,l.bindTime=r.detail.bindTime||10,e.currentEdit=s()({},l),e.showEdit=!0}if(r.detail&&3==r.detail.cmdType){var c={args:""};c.devices=r.detail.devices,c.bindTime=r.detail.bindTime||10,e.currentEdit=s()({},c),e.editCmd(e.currentEdit)}if(r.detail&&4==r.detail.cmdType){var d=r.detail.infoName?r.detail.infoName:"";if(-1!=d.indexOf("item")){var u=r.detail||{},h={deviceId:u.deviceId,id:u.device,itemVal:u.itemVal,itemId:u.item,itemName:u.itemName};e.$eventHub.$emit("deviceInfo",n()(h))}if(-1!=d.indexOf("alarm")){var f=r.detail||{},m={deviceId:f.deviceId,id:f.device,itemVal:f.itemVal,itemId:f.item,itemName:f.itemName};e.$eventHub.$emit("alarmInfo",n()(m))}if(-1!=d.indexOf("video")){var p=+d.substring(5);e.$eventHub.$emit("videoId",p)}if(-1!=d.indexOf("group")){var g=+d.substring(5);e.$eventHub.$emit("groupId",g)}}if(r.detail&&1==r.detail.infoType){var y={};y.infoDevice=r.detail.infoDevice,y.infoDeviceId=r.detail.infoDeviceId,y.infoDeviceName=r.detail.infoDeviceName,y.infoItem=r.detail.infoItem,y.infoItemName=r.detail.infoItemName,y.infoName=r.detail.infoName,e.$emit("on-info",y)}r.detail&&2==r.detail.type&&e.showModuleId.push(r.detail.module)}}}}),this.loadModuleInfo(),this.$eventHub.$on("sl-main-size-change",function(){e.refreshScale()})},destroyed:function(){this.stopGraphRefresh()}},b={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"viewer",staticClass:"graph-viewer",style:{background:e.graphStyle.background}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.showView,expression:"showView"}],ref:"graph",staticClass:"graph",style:e.graphStyle}),e._v(" "),i("Icon",{directives:[{name:"show",rawName:"v-show",value:e.showModuleId.length>0,expression:"showModuleId.length>0"}],staticClass:"btn-reset",attrs:{type:"md-backspace",size:"26"},on:{click:function(t){e.reset()}}}),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.showView&&!e.LoadComplete,expression:"!showView && !LoadComplete"}],staticClass:"graph-cover"},[i("Icon",{staticStyle:{animation:"ani-demo-spin 1s linear infinite"},attrs:{type:"ios-loading"}})],1),e._v(" "),i("Modal",{staticClass:"plan-modal",attrs:{title:e.$t_p("issue_order"),"footer-hide":"","mask-closable":!1,"class-name":"vertical-center-modal",width:e.$flexible(400)},model:{value:e.showEdit,callback:function(t){e.showEdit=t},expression:"showEdit"}},[e.showEdit?i("div",{staticClass:"plan-edit"},[i("Form",{ref:"formBase",staticClass:"edit-form",attrs:{rules:e.InfoRules,model:e.currentEdit,"label-width":e.$flexible(110)}},[i("FormItem",{staticClass:"form-item",attrs:{label:e.$t_p("issue_param")+"：",prop:"ruleName"}},[i("Input",{attrs:{placeholder:e.$t_p("issue_param_placeholder")},model:{value:e.currentEdit.args,callback:function(t){e.$set(e.currentEdit,"args",t)},expression:"currentEdit.args"}})],1),e._v(" "),i("div",{staticClass:"form-ops ",staticStyle:{"text-align":"right","padding-bottom":"0"}},[i("Button",{staticClass:"btn btn-cancel",attrs:{disabled:e.planSaving},on:{click:function(t){e.showEdit=!1}}},[e._v(e._s(e.$t_p("cancel")))]),e._v(" "),i("Button",{staticClass:"btn",attrs:{type:"primary",loading:e.planSaving},on:{click:e.onPlanSave}},[e._v(e._s(e.$t_p("issue")))])],1)],1)],1):e._e()]),e._v(" "),i("Modal",{staticClass:"plan-modal",attrs:{title:e.$t_p("history_data"),"footer-hide":"","mask-closable":!1,"class-name":"vertical-center-modal",width:e.$flexible(500)},model:{value:e.showInfo,callback:function(t){e.showInfo=t},expression:"showInfo"}},[e.showInfo?i("div",{staticClass:"plan-edit"},[i("DatePicker",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticStyle:{width:"350px"},attrs:{format:"yyyy-MM-dd HH:mm:ss",type:"datetimerange",placement:"bottom-end",placeholder:e.$t_p("range_time_placeholder")},model:{value:e.timeRange,callback:function(t){e.timeRange=t},expression:"timeRange"}}),e._v(" "),i("div",{staticClass:"chart",staticStyle:{width:"100%",height:"400px"}},[i("Spin",{directives:[{name:"show",rawName:"v-show",value:e.chartLoading,expression:"chartLoading"}],staticStyle:{width:"100%",height:"100%"},attrs:{fix:""}},[i("Icon",{staticClass:"demo-spin-icon-load",attrs:{type:"ios-loading",size:"18"}}),e._v(" "),i("div",[e._v("Loading")])],1),e._v(" "),i("ChartBase",{ref:"chart",staticClass:"chart-ele",staticStyle:{width:"100%",height:"100%"},attrs:{options:e.chartOptions}})],1)],1):e._e()])],1)},staticRenderFns:[]};var w=i("VU/8")(y,b,!1,function(e){i("aAh+"),i("c42R")},"data-v-2458d452",null).exports;t.a=w},sQFq:function(e,t){}});
//# sourceMappingURL=3.7cc76c80978a7359f1ea.js.map